<html>
<head>
  <style>
    html { height: 100%; }
    body {width: 100%; height: 100%; margin: 0; background-color: #333;}
    canvas { width: 100%; height: 100%; margin: 0; }
  </style>
</head>
<body>
  <canvas id="c"></canvas>
</body>
<script>
var ws = new WebSocket("ws://"+location.host);
ws.binaryType = 'arraybuffer';
ws.addEventListener('message',  handleSamples);

function handleSamples(msg) {
  var samples = new Float32Array(msg.data)
  renderSamples(samples);
}

var canvas = document.getElementById('c');
var cw = canvas.width = canvas.offsetWidth;
var ch = canvas.height = canvas.offsetHeight;
var cmin = Math.min(cw,ch);
var ctx = canvas.getContext('2d');
var colors = ['hsla(0,100%,60%,1.0)','hsla(30,100%,50%,1.0)','hsla(60,100%,50%,1.0)','hsla(120,100%,50%,1.0)','hsla(180,100%,50%,1.0)']

function renderSamples(samples) {
  ctx.fillStyle = 'rgba(52,52,52,.2)';
  ctx.fillRect(0,0,cw,ch);
  ctx.lineWidth = 2;
  var separation = cmin / 6;
  var marginTop = (ch-cmin)/2 + separation;
  var marginLeft = (cw-cmin)/2 + separation;
  for (var i=0; i<5; i++) {
    for (var j=0; j<5; j++) {
      ctx.strokeStyle = colors[j];
      ctx.beginPath();
      var radius = .5*separation*Math.log10(1+samples[i*5+j]);
      ctx.arc(marginLeft + separation*j, marginTop + separation*i, radius, 0, 2*Math.PI, true);
      ctx.stroke();
    }
  }
}
</script>
</html>
